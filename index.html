<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- ✅ (2) запрет зума/приближения на мобилках -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#ffffff" />
  <title>FURUYUME</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fff;
      --text:#0a0a0a;
      --muted:#6b6b6b;
      --hair:#e9e9e9;
      --glass: rgba(255,255,255,.58);
      --glass2: rgba(255,255,255,.36);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 18px;
      --ls: -0.05em;
      --ls-soft: -0.05em;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      letter-spacing: var(--ls);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
      overflow-x:hidden;
      touch-action: pan-y; /* блокируем pinch-zoom, оставляем вертикальный скролл */
    }

    a{ color:inherit; text-decoration:none; }
    button{ font:inherit; letter-spacing: inherit; background:none; border:0; padding:0; color:inherit; }

    /* Safe areas for Telegram iOS */
    .safe{
      padding-left: max(16px, env(safe-area-inset-left));
      padding-right: max(16px, env(safe-area-inset-right));
    }
    .top-safe{ padding-top: calc(env(safe-area-inset-top) + 2px); }
    .bottom-safe{ padding-bottom: max(16px, env(safe-area-inset-bottom)); }

    /* Loading */
    .loader-screen{
      position:fixed; inset:0;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      z-index:9999;
      transition: opacity .28s ease, transform .28s ease;
    }
    .loader-screen.hide{
      opacity:0;
      transform: scale(.99);
      pointer-events:none;
    }
    .spinner{
      width:44px; height:44px;
      border-radius:999px;
      border:3px solid #e8e8e8;
      border-top-color:#111;
      animation: spin .85s linear infinite;
      margin-bottom:14px;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }
    .loader-title{
      font-weight:600;
      font-size:14px;
      letter-spacing: var(--ls);
      text-transform: uppercase;
    }
    .loader-sub{
      margin-top:8px;
      max-width: 280px;
      text-align:center;
      font-size:12px;
      color:var(--muted);
      letter-spacing: calc(var(--ls) + 0.02em);
      line-height: 1.35;
    }
    .loader-hint{
      margin-top:16px;
      font-size:12px;
      color: #8a8a8a;
      letter-spacing: calc(var(--ls) + 0.03em);
      opacity:0;
      transform: translateY(2px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .loader-hint.show{ opacity:1; transform: translateY(0); }

    /* Layout */
    .app{
      min-height:100%;
      display:flex;
      flex-direction:column;
    }

    .header-space{ height: 0px; }

    /* =========================
       ✅ (1) NEW MAIN HEADER LOOK
       стеклянная плашка как у float, лого слева, кнопки справа
       ========================= */
    .topbar{
      position:relative;
      padding-top: 2px;
      padding-bottom: 6px;
    }

    .topbar-card{
      width: min(520px, 100%);
      margin: 0 auto;
      border-radius: 999px;
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      background-color: rgba(255,255,255,.72);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.06);
      padding: 10px 14px;
    }

    .topbar-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      min-width:0;
    }

    .topbar-left{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      flex:0 0 auto;
    }

    .topbar-right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 16px; /* одинаковое расстояние между словами */
      min-width:0;
      flex:1 1 auto;
      white-space:nowrap;
      overflow:hidden;
      font-weight:400;
      font-size:12px;
      text-transform: uppercase;
      letter-spacing: var(--ls);
    }

    .nav-item{
      opacity: .92;
      transition: opacity .18s ease, transform .18s ease;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      user-select:none;
      flex:0 0 auto;
    }
    .nav-item:active{ opacity: .65; transform: scale(.98); }

    /* Logo */
    .brand{
      display:flex;
      align-items:center;
      justify-content:center;
      width:44px; height:44px; /* чуть меньше, чтобы справа текст не давил */
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      flex:0 0 auto;
    }
    .brand img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    /* ✅ (4) место под фотку под шапкой */
    .hero{
      padding-top: 10px;
      padding-bottom: 6px;
    }
    .hero-card{
      width: min(520px, 100%);
      margin: 0 auto;
      border-radius: 22px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.06);
      background: rgba(0,0,0,.02);
    }
    .hero-card img{
      width:100%;
      height:auto;
      display:block;
      object-fit:cover;
    }

    /* =========================
       FLOATING GLASS HEADER
       ✅ (1) лого слева, кнопки справа
       ✅ сделать поменьше, чтобы не налезало
       ========================= */
    .floatbar{
      position:fixed;
      left:0; right:0;
      top: calc(env(safe-area-inset-top) + 2px);
      z-index: 2000;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }

    .floatbar-card{
      pointer-events:auto;
      width: min(420px, calc(100% - 28px));
      border-radius: 999px;
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      background-color: rgba(255,255,255,.72);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.06);
      padding: 8px 12px; /* меньше */
      opacity:0;
      transform: translateY(-10px);
      transition: opacity .22s ease, transform .22s ease;
      will-change: opacity, transform;
      contain: paint;
    }
    .floatbar.show .floatbar-card{
      opacity:1;
      transform: translateY(0);
    }

    .floatbar-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-width:0;
    }
    .floatbar-left{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      flex:0 0 auto;
    }
    .floatbar-right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 12px; /* компактнее */
      flex:1 1 auto;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      font-weight:400;
      font-size:11px; /* меньше */
      text-transform: uppercase;
      letter-spacing: var(--ls);
    }

    .floatbrand{
      width:30px; height:30px; /* меньше, чтобы текст не налезал */
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      user-select:none;
      flex:0 0 auto;
    }
    .floatbrand img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    /* =========================
       SEARCH DRAWER (dropdown under Search button)
       ========================= */
    .drawer{
      position: fixed;
      left: 0; right: 0;
      z-index: 3500;
      pointer-events: none; /* включаем только когда open */
    }
    .drawer.open{ pointer-events:auto; }

    .drawer-card{
      width: min(520px, calc(100% - 28px));
      margin: 0 auto;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.68));
      background-color: rgba(255,255,255,.88);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 18px 50px rgba(0,0,0,.12);
      border: 1px solid rgba(0,0,0,.08);

      overflow:hidden;

      opacity:0;
      transform: translateY(-6px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .drawer.open .drawer-card{
      opacity:1;
      transform: translateY(0);
    }

    .drawer-top{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .drawer-top input{
      width:100%;
      border: 0;
      outline: none;
      background: transparent;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      letter-spacing: var(--ls);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .drawer-top input::placeholder{
      color: rgba(10,10,10,.45);
      font-weight: 600;
    }
    .drawer-close{
      flex:0 0 auto;
      font-size:12px;
      font-weight:700;
      letter-spacing: var(--ls);
      text-transform: uppercase;
      opacity:.75;
      cursor:pointer;
      padding: 6px 8px;
      border-radius: 10px;
      transition: opacity .18s ease, transform .18s ease, background .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .drawer-close:active{
      opacity:.6;
      transform: scale(.98);
      background: rgba(0,0,0,.04);
    }

    .drawer-results{
      padding: 10px 12px 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      max-height: 44vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    .result{
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.05);
    }
    .result-img{
      width:44px; height:44px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
      overflow:hidden;
    }
    .result-img img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      pointer-events:none;
      user-select:none;
    }
    .result-mid{
      min-width:0;
      flex:1 1 auto;
    }
    .result-name{
      font-size:11px;
      font-weight:800;
      text-transform: uppercase;
      letter-spacing: var(--ls);
      line-height: 1.15;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .result-meta{
      margin-top: 6px;
      font-size:10px;
      font-weight:700;
      text-transform: uppercase;
      letter-spacing: calc(var(--ls) + 0.02em);
      opacity:.75;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .result-price{
      flex:0 0 auto;
      font-size:11px;
      font-weight:900;
      text-transform: uppercase;
      letter-spacing: calc(var(--ls) + 0.02em);
      opacity:.92;
    }

    .drawer-empty{
      padding: 8px 2px 0;
      text-align:center;
      font-size:11px;
      font-weight:700;
      text-transform: uppercase;
      letter-spacing: calc(var(--ls) + 0.02em);
      opacity:.6;
    }

    /* =========================
       CART MODAL
       ========================= */
    .modal{
      position:fixed; inset:0;
      z-index: 4000;
      display:none;
      align-items:flex-end;
      justify-content:center;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .modal.show{ display:flex; }

    .sheet{
      width: min(520px, 100%);
      margin: 0 auto;
      border-radius: 22px 22px 0 0;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 -18px 60px rgba(0,0,0,.18);
      padding: 14px 14px 18px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .modal.show .sheet{
      transform: translateY(0);
      opacity:1;
    }
    .sheet-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .sheet-title{
      font-size:12px;
      font-weight:900;
      letter-spacing: var(--ls);
      text-transform: uppercase;
    }
    .sheet-close{
      font-size:12px;
      font-weight:800;
      letter-spacing: var(--ls);
      text-transform: uppercase;
      opacity:.7;
      padding: 8px 10px;
      border-radius: 12px;
      transition: opacity .18s ease, transform .18s ease, background .18s ease;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }
    .sheet-close:active{
      opacity:.55;
      transform: scale(.98);
      background: rgba(0,0,0,.04);
    }
    .sheet-body{
      padding-top: 12px;
      font-size:11px;
      font-weight:700;
      letter-spacing: calc(var(--ls) + 0.02em);
      text-transform: uppercase;
      opacity:.7;
      line-height: 1.35;
    }

    /* Categories (STATIC) */
    .categories{
      padding-top: 10px;
      padding-bottom: 18px;
    }
    .cat-wrap{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap: 10px 18px;
      padding-top: 6px;
    }
    .cat{
      font-weight:600;
      font-size:10px;
      text-transform: uppercase;
      opacity:.9;
      cursor:pointer;
      padding: 7px 12px;
      border-radius: 10px;
      transition: opacity .18s ease, transform .18s ease, background .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .cat:active{ transform: scale(.98); opacity:.7; }
    .cat.active{
      opacity: 1;
      background: rgba(0,0,0,.04);
    }

    /* Products grid */
    .content{
      flex:1;
      padding-bottom: 22px;
    }
    .products{
      width: min(520px, 100%);
      margin: 0 auto;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px 18px;
      align-items:start;
      padding-top: 4px;
      transition: opacity .18s ease, transform .18s ease;
    }
    .grid.fade-out{
      opacity:0;
      transform: translateY(4px);
    }

    .card{
      text-align:center;
      user-select:none;
    }

    .img{
      width:100%;
      aspect-ratio: 1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:visible;
      background: transparent;
      border: none;
      border-radius: 0;
    }

    .product-photo{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display:block;
      -webkit-user-drag: none;
      user-select:none;
      pointer-events:none;
      transform: translateZ(0);
    }

    .name{
      margin-top: 14px;
      font-weight:650;
      font-size:14px;
      text-transform: uppercase;
      letter-spacing: var(--ls);

      line-height: 1.1;
      min-height: calc(2 * 1.1em);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .desc{
      margin-top: 6px;
      font-weight:600;
      font-size:12px;
      text-transform: uppercase;
      color:#111;
      opacity:.85;
      letter-spacing: calc(var(--ls) + 0.02em);
    }
    .price-row{
      margin-top: 10px;
      display:flex;
      align-items:baseline;
      justify-content:center;
      gap: 8px;
      font-size:14px;
      font-weight:700;
      letter-spacing: calc(var(--ls) + 0.02em);
      text-transform: uppercase;
    }
    .old{
      font-weight:600;
      color: #8b8b8b;
      text-decoration: line-through;
      font-size: 12px;
      letter-spacing: calc(var(--ls) + 0.03em);
    }

    .dolyami{
      margin-top: 10px;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.06);
      color:#111;
      font-weight:700;
      font-size:12px;
      letter-spacing: var(--ls-soft);
      text-transform: none;
    }
    .dolyami-icon{
      width:18px;
      height:18px;
      display:block;
      object-fit:contain;
      flex:0 0 auto;
    }

    /* Footer */
    .footer{
      padding-top: 26px;
      padding-bottom: 34px;
    }

    .footer-links,
    .footer-legal{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap: 12px 18px;
      font-weight:600;
      font-size:9px;
      text-transform: uppercase;
      letter-spacing: calc(var(--ls) + 0.03em);
      line-height: 1.2;
    }
    .footer-links{
      opacity: .92;
      margin-bottom: 12px;
    }
    .footer-legal{
      opacity: .85;
      margin-top: 0;
    }

    .footer-copy{
      margin-top: 12px;
      text-align:center;
      font-weight:600;
      font-size:9px;
      text-transform: uppercase;
      letter-spacing: calc(var(--ls) + 0.03em);
      opacity: .85;
      line-height: 1.2;
    }

    .footer a{
      transition: opacity .18s ease, transform .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .footer a:active{ opacity:.65; transform: scale(.99); }

    /* Small devices polish */
    @media (max-width: 360px){
      .topbar-card{ padding: 9px 12px; }
      .brand{ width:40px; height:40px; }
      .topbar-right{ gap: 12px; font-size: 11px; }
      .floatbrand{ width:28px; height:28px; }
      .floatbar-right{ gap: 10px; font-size: 10.5px; }
      .cat{ font-size: 10px; }
      .grid{ gap: 26px 14px; }
      .name{ font-size: 13px; min-height: calc(2 * 1.1em); }
    }
  </style>
</head>

<body>
  <!-- LOADER -->
  <div id="loader" class="loader-screen safe top-safe bottom-safe" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <div class="loader-title">Загрузка</div>
    <div class="loader-sub">Прогружаем всё нужное. Если загрузка идёт слишком долго — перезагрузите приложение.</div>
    <div id="loaderHint" class="loader-hint">Совет: иногда помогает закрыть и открыть Telegram заново.</div>
  </div>

  <!-- SEARCH DRAWER (fixed, will anchor under the active header) -->
  <div id="searchDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-card" role="dialog" aria-label="Поиск товаров">
      <div class="drawer-top">
        <input id="searchInput" type="text" inputmode="search" autocomplete="off" placeholder="ВВЕДИТЕ НАЗВАНИЕ ТОВАРА" aria-label="Поиск товаров">
        <button id="searchClose" class="drawer-close" type="button" aria-label="Закрыть поиск">закрыть</button>
      </div>
      <div id="searchResults" class="drawer-results" aria-live="polite">
        <div class="drawer-empty">начните ввод — появятся товары</div>
      </div>
    </div>
  </div>

  <!-- CART MODAL -->
  <div id="cartModal" class="modal" aria-hidden="true">
    <div class="sheet safe bottom-safe" role="dialog" aria-label="Корзина">
      <div class="sheet-head">
        <div class="sheet-title">корзина</div>
        <button id="cartClose" class="sheet-close" type="button">закрыть</button>
      </div>
      <div class="sheet-body">
        это черновик корзины. позже сюда добавим товары, количество и оформление.
      </div>
    </div>
  </div>

  <!-- FLOATING GLASS HEADER -->
  <div id="floatbar" class="floatbar safe" aria-hidden="true">
    <div class="floatbar-card">
      <div class="floatbar-inner">
        <div class="floatbar-left">
          <button class="floatbrand" id="floatLogoBtn" type="button" aria-label="FURUYUME — наверх">
            <img src="logo.png" alt="FURUYUME">
          </button>
        </div>

        <div class="floatbar-right">
          <button class="nav-item" type="button" data-action="search" aria-label="ПОИСК">ПОИСК</button>
          <a class="nav-item" href="https://t.me/furuyumemngrs" target="_blank" rel="noopener" aria-label="Поддержка">поддержка</a>
          <a class="nav-item" href="https://t.me/furuyumedelivery/9" target="_blank" rel="noopener" aria-label="Отзывы">отзывы</a>
          <button class="nav-item" type="button" data-action="cart" aria-label="КОРЗИНА">КОРЗИНА</button>
        </div>
      </div>
    </div>
  </div>

  <div class="app">
    <div class="header-space" aria-hidden="true"></div>

    <!-- MAIN HEADER -->
    <header id="mainHeader" class="topbar safe top-safe">
      <div class="topbar-card">
        <div class="topbar-inner">
          <div class="topbar-left">
            <button class="brand" id="logoBtn" type="button" aria-label="FURUYUME — наверх">
              <img src="logo.png" alt="FURUYUME">
            </button>
          </div>

          <nav class="topbar-right" aria-label="Меню">
            <button class="nav-item" type="button" data-action="search" aria-label="ПОИСК">ПОИСК</button>
            <a class="nav-item" href="https://t.me/furuyumemngrs" target="_blank" rel="noopener" aria-label="Поддержка">поддержка</a>
            <a class="nav-item" href="https://t.me/furuyumedelivery/9" target="_blank" rel="noopener" aria-label="Отзывы">отзывы</a>
            <button class="nav-item" type="button" data-action="cart" aria-label="КОРЗИНА">КОРЗИНА</button>
          </nav>
        </div>
      </div>
    </header>

    <!-- HERO IMAGE -->
    <section class="hero safe" aria-label="Фото">
      <div class="hero-card">
        <img src="hero.png" alt="FURUYUME">
      </div>
    </section>

    <!-- CATEGORIES (STATIC) -->
    <section class="categories safe" aria-label="Категории">
      <div class="cat-wrap" id="catWrap">
        <!-- injected -->
      </div>
    </section>

    <!-- CONTENT -->
    <main class="content safe" aria-label="Товары">
      <section class="products">
        <div id="grid" class="grid" aria-live="polite">
          <!-- injected -->
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer safe bottom-safe">
      <div class="footer-links">
        <a href="https://t.me/" target="_blank" rel="noopener">telegram</a>
        <a href="https://www.tiktok.com/" target="_blank" rel="noopener">tiktok</a>
        <a href="https://www.instagram.com/" target="_blank" rel="noopener">instagram</a>
        <a href="https://example.com/" target="_blank" rel="noopener">site</a>
      </div>

      <div class="footer-legal">
        <a href="https://example.com/privacy" target="_blank" rel="noopener">политика конфиденциальности</a>
        <a href="https://example.com/offer" target="_blank" rel="noopener">договор оферты</a>
      </div>

      <div class="footer-copy">FURUYUME © 2026</div>
    </footer>
  </div>

  <script>
    const CATEGORIES = [
      { id: "all", label: "Все" },
      { id: "olymp", label: "Олимпийки" },
      { id: "bombers", label: "Бомберы" },
      { id: "hoodies", label: "Худи" },
      { id: "longsleeves", label: "Лонгсливы" },
      { id: "tees", label: "Футболки" },
      { id: "pants", label: "Штаны" },
      { id: "shoes", label: "Обувь" }
    ];

    // assets рядом:
    // logo.png / hero.png / sweater.png / dolyami.png
    const PRODUCTS = [
      { id:"p1", img:"sweater.png", name:"REFLECTIVE SWEATER (BLACK) — ARCHIVE DROP", badge:"РАСПРОДАЖА", price:"7 600 RUB", oldPrice:"11 600 RUB", dolyami:"Долями по 1 900 ₽", categories:["olymp"] },
      { id:"p2", img:"sweater.png", name:"ARCHIVE TRACK JACKET — RARE PIECE",        badge:"LIMITED",     price:"12 900 RUB", oldPrice:"15 900 RUB", dolyami:"Долями по 3 225 ₽", categories:["olymp"] },
      { id:"p3", img:"sweater.png", name:"BOMBER (VINTAGE) — EARLY 2000s",            badge:"РАСПРОДАЖА",  price:"9 900 RUB",  oldPrice:"13 900 RUB", dolyami:"Долями по 2 475 ₽", categories:["bombers"] },
      { id:"p4", img:"sweater.png", name:"HOODIE (ARCHIVE) — SOFT WASHED",            badge:"DROP",        price:"8 500 RUB",  oldPrice:"10 900 RUB", dolyami:"Долями по 2 125 ₽", categories:["hoodies"] },
      { id:"p5", img:"sweater.png", name:"LONGSLEEVE (RARE) — GRAPHIC EDITION",       badge:"РАСПРОДАЖА",  price:"5 400 RUB",  oldPrice:"7 900 RUB",  dolyami:"Долями по 1 350 ₽", categories:["longsleeves"] },
      { id:"p6", img:"sweater.png", name:"PANTS (ARCHIVE) — STRAIGHT FIT",            badge:"NEW",         price:"6 800 RUB",  oldPrice:"8 900 RUB",  dolyami:"Долями по 1 700 ₽", categories:["pants"] }
    ];

    const loader = document.getElementById("loader");
    const loaderHint = document.getElementById("loaderHint");

    const mainHeader = document.getElementById("mainHeader");
    const floatbar = document.getElementById("floatbar");
    const logoBtn = document.getElementById("logoBtn");
    const floatLogoBtn = document.getElementById("floatLogoBtn");

    const catWrap = document.getElementById("catWrap");
    const grid = document.getElementById("grid");

    // Search drawer
    const searchDrawer = document.getElementById("searchDrawer");
    const searchInput = document.getElementById("searchInput");
    const searchClose = document.getElementById("searchClose");
    const searchResults = document.getElementById("searchResults");

    // Cart modal
    const cartModal = document.getElementById("cartModal");
    const cartClose = document.getElementById("cartClose");

    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function renderCategories(activeId) {
      catWrap.innerHTML = CATEGORIES.map(c => {
        const active = c.id === activeId ? "active" : "";
        return `<button class="cat ${active}" data-cat="${c.id}" type="button">${c.label}</button>`;
      }).join("");
    }

    function filterProducts(catId) {
      if (catId === "all") return PRODUCTS;
      return PRODUCTS.filter(p => (p.categories || []).includes(catId));
    }

    function renderProducts(catId) {
      const items = filterProducts(catId);
      grid.innerHTML = items.map(p => `
        <article class="card">
          <div class="img">
            <img class="product-photo" src="${p.img}" alt="${p.name}">
          </div>
          <div class="name">${p.name}</div>
          <div class="desc">${p.badge}</div>
          <div class="price-row">
            <span>${p.price}</span>
            <span class="old">${p.oldPrice}</span>
          </div>
          <div class="dolyami" aria-label="${p.dolyami}">
            <img class="dolyami-icon" src="dolyami.png" alt="" aria-hidden="true">
            <span>${p.dolyami}</span>
          </div>
        </article>
      `).join("");
    }

    async function switchCategory(nextId) {
      grid.classList.add("fade-out");
      await sleep(160);
      renderProducts(nextId);
      await sleep(20);
      grid.classList.remove("fade-out");
    }

    function setupFloatingHeader() {
      const io = new IntersectionObserver((entries) => {
        const e = entries[0];
        if (!e) return;
        const show = !e.isIntersecting;
        floatbar.classList.toggle("show", show);
        floatbar.setAttribute("aria-hidden", show ? "false" : "true");
      }, { threshold: 0.1 });

      io.observe(mainHeader);
    }

    async function hideLoaderSoon() {
      const hintTimer = setTimeout(() => loaderHint.classList.add("show"), 2200);

      try { if (document.fonts && document.fonts.ready) await Promise.race([document.fonts.ready, sleep(700)]); } catch(e){}
      await sleep(420);

      clearTimeout(hintTimer);
      loader.classList.add("hide");
      await sleep(300);
      loader.style.display = "none";
    }

    // =========================
    // ✅ SEARCH LOGIC (2)
    // =========================
    function getHeaderAnchorRect() {
      // если плавающая шапка видна — якорим под ней, иначе под основной
      const isFloat = floatbar.classList.contains("show");
      const anchor = isFloat ? floatbar.querySelector(".floatbar-card") : mainHeader.querySelector(".topbar-card");
      if (!anchor) return null;
      return anchor.getBoundingClientRect();
    }

    function setDrawerTop() {
      const r = getHeaderAnchorRect();
      const top = r ? (r.bottom + 10) : (10 + (window.visualViewport ? window.visualViewport.offsetTop : 0));
      searchDrawer.style.top = `${Math.max(8, top)}px`;
    }

    function renderSearchResults(query) {
      const q = (query || "").trim().toLowerCase();
      if (!q) {
        searchResults.innerHTML = `<div class="drawer-empty">начните ввод — появятся товары</div>`;
        return;
      }

      const found = PRODUCTS.filter(p => {
        const hay = `${p.name} ${p.badge} ${p.price}`.toLowerCase();
        return hay.includes(q);
      }).slice(0, 8);

      if (!found.length) {
        searchResults.innerHTML = `<div class="drawer-empty">ничего не найдено</div>`;
        return;
      }

      searchResults.innerHTML = found.map(p => `
        <div class="result" role="listitem" aria-label="${p.name}">
          <div class="result-img"><img src="${p.img}" alt=""></div>
          <div class="result-mid">
            <div class="result-name">${p.name}</div>
            <div class="result-meta">${p.badge}</div>
          </div>
          <div class="result-price">${p.price}</div>
        </div>
      `).join("");
    }

    function openSearch() {
      setDrawerTop();
      searchDrawer.classList.add("open");
      searchDrawer.setAttribute("aria-hidden", "false");
      // чуть позже, чтобы анимация/позиция села
      setTimeout(() => {
        try { searchInput.focus({ preventScroll: true }); } catch(e){ searchInput.focus(); }
      }, 60);
      // начальное состояние
      renderSearchResults(searchInput.value);
    }

    function closeSearch() {
      searchDrawer.classList.remove("open");
      searchDrawer.setAttribute("aria-hidden", "true");
    }

    function toggleSearch() {
      const isOpen = searchDrawer.classList.contains("open");
      if (isOpen) closeSearch();
      else openSearch();
    }

    // =========================
    // ✅ CART LOGIC (2)
    // =========================
    function openCart() {
      cartModal.classList.add("show");
      cartModal.setAttribute("aria-hidden", "false");
    }
    function closeCart() {
      cartModal.classList.remove("show");
      cartModal.setAttribute("aria-hidden", "true");
    }

    // =========================
    // INIT
    // =========================
    (function init(){
      const DEFAULT_CAT = "all";
      renderCategories(DEFAULT_CAT);
      renderProducts(DEFAULT_CAT);

      setupFloatingHeader();

      if (logoBtn) logoBtn.addEventListener("click", scrollToTop);
      if (floatLogoBtn) floatLogoBtn.addEventListener("click", scrollToTop);

      catWrap.addEventListener("click", async (e) => {
        const btn = e.target.closest("[data-cat]");
        if (!btn) return;
        const nextId = btn.getAttribute("data-cat");
        const current = catWrap.querySelector(".cat.active")?.getAttribute("data-cat");
        if (nextId === current) return;

        catWrap.querySelectorAll(".cat").forEach(x => x.classList.remove("active"));
        btn.classList.add("active");

        await switchCategory(nextId);
      });

      // ✅ кнопки шапки: поиск / корзина (работают и в main, и в float)
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-action]");
        if (!btn) return;

        const act = btn.getAttribute("data-action");
        if (act === "search") {
          toggleSearch();
        }
        if (act === "cart") {
          openCart();
        }
      });

      // поиск: закрыть
      searchClose.addEventListener("click", closeSearch);
      searchInput.addEventListener("input", (e) => renderSearchResults(e.target.value));

      // закрытие поиска по клику вне карточки
      document.addEventListener("pointerdown", (e) => {
        if (!searchDrawer.classList.contains("open")) return;
        const card = searchDrawer.querySelector(".drawer-card");
        const actionBtn = e.target.closest('[data-action="search"]');
        if (actionBtn) return; // кликом по кнопке управляем toggleSearch()
        if (card && !card.contains(e.target)) closeSearch();
      });

      // следим за позиционированием drawer при скролле/ресайзе
      window.addEventListener("scroll", () => {
        if (!searchDrawer.classList.contains("open")) return;
        setDrawerTop();
      }, { passive: true });
      window.addEventListener("resize", () => {
        if (!searchDrawer.classList.contains("open")) return;
        setDrawerTop();
      });

      // корзина: закрыть
      cartClose.addEventListener("click", closeCart);
      cartModal.addEventListener("click", (e) => {
        if (e.target === cartModal) closeCart();
      });

      // ESC закрывает (на всякий)
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          closeSearch();
          closeCart();
        }
      });

      // ✅ запрет pinch-zoom / ctrl+wheel / double-tap zoom
      document.addEventListener('gesturestart', (e) => e.preventDefault());
      document.addEventListener('gesturechange', (e) => e.preventDefault());
      document.addEventListener('gestureend', (e) => e.preventDefault());

      document.addEventListener('wheel', (e) => {
        if (e.ctrlKey) e.preventDefault();
      }, { passive: false });

      let lastTouchEnd = 0;
      document.addEventListener('touchend', function (event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 250) event.preventDefault();
        lastTouchEnd = now;
      }, { passive: false });

      // loader out
      if (document.readyState === "complete" || document.readyState === "interactive") {
        hideLoaderSoon();
      } else {
        document.addEventListener("DOMContentLoaded", hideLoaderSoon, { once: true });
      }
    })();
  </script>
</body>
</html>
